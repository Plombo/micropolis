#include <stdio.h>
#include <stdlib.h>
#include "micropolis.h"
#include "readpng.h"
#include "map.h"

#define COL_BYTES (BYTES_PER_TILE * WORLD_H)
#define ROW_BYTES BYTES_PER_TILE

extern const unsigned int colors[];

// XXX: hackity hack
size_t pointerAsInt(unsigned char* ptr)
{
	printf("pointer is %p\n", ptr);
	return (size_t)ptr;
}

/**
 * Creates a buffer that can be used for the minimap.
 */
void* createMapBuffer()
{
	return malloc(WORLD_W * WORLD_H * 4);
}

/**
 * Renders the minimap to a buffer.
 * @param engine a pointer to the engine
 * @param dest the buffer to write the minimap to
 */
void renderMap(void* tileBuffer, unsigned char* buf)
{	
	int* dst = (int*)buf;
	unsigned char* tiles = (unsigned char*)tileBuffer;
	for(int y=0; y<WORLD_H;  y++)
	{
		for(int x=0; x<WORLD_W; x++)
		{
			int tile = *(unsigned short*)(tiles + ROW_BYTES*y + COL_BYTES*x) & LOMASK;
			*dst++ = colors[tile];
		}
	}
}

const unsigned int colors[] = {
	0xffd1805b,
	0xffc37b6b,
	0xff6561e0,
	0xff545df7,
	0xff6561dc,
	0xff6b62c8,
	0xff7365ca,
	0xffaa7585,
	0xff936c96,
	0xff7063c2,
	0xff7264c4,
	0xff8e6c9e,
	0xff9b7092,
	0xff7669cd,
	0xff766bc3,
	0xff92719b,
	0xff936f9b,
	0xff7866bc,
	0xff846db5,
	0xff9f7493,
	0xffa466ae,
	0xff739e4e,
	0xff46bd17,
	0xff41b021,
	0xff49ad24,
	0xff57a72b,
	0xff6c9e37,
	0xff7e983f,
	0xff889a44,
	0xff66a832,
	0xff46b223,
	0xff44ae22,
	0xff42b022,
	0xff54a72a,
	0xff6f9d38,
	0xff8e9746,
	0xff5aac2d,
	0xff00cb00,
	0xffa37463,
	0xff816f74,
	0xff23c017,
	0xff16d807,
	0xff1ad50d,
	0xff24c812,
	0xff7e5b3f,
	0xff95504a,
	0xff8e563b,
	0xff7b5143,
	0xff7f7bd4,
	0xff8183f4,
	0xff7c82f4,
	0xff8b7bd9,
	0xffc86f5d,
	0xff8e5c45,
	0xff845044,
	0xff806f5b,
	0xffe08534,
	0xfff37523,
	0xffe8802d,
	0xffe7792f,
	0xffe67d2f,
	0xffe6772f,
	0xfff47b26,
	0xffe37135,
	0xff483d61,
	0xff38416a,
	0xff64524c,
	0xff554841,
	0xff805c50,
	0xff9b6857,
	0xff5f4e49,
	0xff63524c,
	0xff66534c,
	0xff5f4e49,
	0xff5a504c,
	0xff564f4c,
	0xff615a56,
	0xff655546,
	0xff65535c,
	0xff6463dc,
	0xff43477c,
	0xff464460,
	0xff685650,
	0xff594d46,
	0xff835f53,
	0xff9c6858,
	0xff62524c,
	0xff675550,
	0xff6a5750,
	0xff62524c,
	0xff5e5350,
	0xff59524f,
	0xff655e5a,
	0xff69594a,
	0xff68565f,
	0xff6463dc,
	0xff43477c,
	0xff474561,
	0xff67554f,
	0xff5b4e47,
	0xff846054,
	0xff9f6b5a,
	0xff675751,
	0xff695751,
	0xff695650,
	0xff63524d,
	0xff5d534f,
	0xff5b5451,
	0xff665f5b,
	0xff695849,
	0xff68575f,
	0xff6363dc,
	0xff43477c,
	0xff474560,
	0xff67554f,
	0xff5b4e47,
	0xff835f53,
	0xff9e6a5a,
	0xff685853,
	0xff695751,
	0xff68554f,
	0xff60504a,
	0xff5d524f,
	0xff5b5451,
	0xff635c58,
	0xff685748,
	0xff67565e,
	0xff6564dd,
	0xff41457a,
	0xff474561,
	0xff685650,
	0xff574b44,
	0xff835f54,
	0xff9c6858,
	0xff665550,
	0xff67554f,
	0xff66534c,
	0xff63524d,
	0xff5f5451,
	0xff564f4c,
	0xff665f5b,
	0xff695949,
	0xff67555e,
	0xff6666df,
	0xff464a7f,
	0xff4a4864,
	0xff6b5953,
	0xff5f524b,
	0xff866256,
	0xffa06c5b,
	0xff6c5b56,
	0xff6e5c57,
	0xff6c5952,
	0xff665550,
	0xff625754,
	0xff5d5653,
	0xff665f5b,
	0xff6d5c4d,
	0xff695860,
	0xff6363dc,
	0xff474a7f,
	0xff4a4864,
	0xff6b5953,
	0xff5e514b,
	0xff866257,
	0xffa06c5b,
	0xff6b5a55,
	0xff6e5d57,
	0xff6b5852,
	0xff665650,
	0xff625754,
	0xff5d5653,
	0xff665f5b,
	0xff6d5c4d,
	0xff6c5a62,
	0xff6564dd,
	0xff45497e,
	0xff4b4964,
	0xff6b5a53,
	0xff5d5049,
	0xff876358,
	0xffa06c5b,
	0xff6b5a55,
	0xff6b5953,
	0xff6a5751,
	0xff665651,
	0xff635855,
	0xff5a5250,
	0xff655f5b,
	0xff6c5c4d,
	0xff68575f,
	0xff6665de,
	0xff45497e,
	0xff4b4964,
	0xff6b5a53,
	0xff5d5049,
	0xff876357,
	0xffa06c5b,
	0xff6a5a55,
	0xff6d5b55,
	0xff6a5750,
	0xff675651,
	0xff635855,
	0xff59524f,
	0xff665f5c,
	0xff6b5b4c,
	0xff665557,
	0xff6261e0,
	0xff6167f8,
	0xff6f6bdb,
	0xffb07365,
	0xffba7554,
	0xffb8765f,
	0xffba7660,
	0xffb0725d,
	0xffb1725d,
	0xffb0725d,
	0xffb2725d,
	0xffac6f5b,
	0xffac6f5c,
	0xffa86e5b,
	0xff7f5945,
	0xff85684d,
	0xffc7c2c5,
	0xff6c73f1,
	0xff6864df,
	0xff896656,
	0xff8a6442,
	0xffb0765e,
	0xffbe7b63,
	0xffa4725b,
	0xffa5735d,
	0xffa57567,
	0xffa77565,
	0xffa07466,
	0xff9f7468,
	0xff9a7061,
	0xff685746,
	0xff5a4d41,
	0xff54493f,
	0xff8f7849,
	0xffa78151,
	0xffaa7d55,
	0xffb7805b,
	0xff8a8445,
	0xffb17c58,
	0xffae8057,
	0xffa77e53,
	0xffa27b4f,
	0xff997253,
	0xff93705c,
	0xff906a5c,
	0xff7d6c4f,
	0xff8d6f46,
	0xff81784a,
	0xff3e722b,
	0xff358b0c,
	0xff249231,
	0xff3fa343,
	0xff6b985d,
	0xff7bb279,
	0xff857c49,
	0xff706b53,
	0xff697055,
	0xff796852,
	0xff565449,
	0xff677757,
	0xff92825d,
	0xff8c714d,
	0xff78773a,
	0xff596a34,
	0xff4f502a,
	0xff66633e,
	0xff746d55,
	0xff7f725c,
	0xff87846c,
	0xff7b7a51,
	0xff686539,
	0xff4f6831,
	0xff4e7044,
	0xff57604d,
	0xff676e46,
	0xff67634e,
	0xff876f53,
	0xff5f634a,
	0xff4e6249,
	0xff4e5d39,
	0xff616d3f,
	0xff5a597f,
	0xff544750,
	0xff42544f,
	0xff8e2643,
	0xff816451,
	0xff796564,
	0xff834132,
	0xff3d4d42,
	0xff5a6746,
	0xff9f7946,
	0xff8b6b73,
	0xff757677,
	0xff905c3e,
	0xffae7a66,
	0xff756f88,
	0xff9e5b45,
	0xffbda890,
	0xffa5b488,
	0xff808965,
	0xff6e6a8d,
	0xff707687,
	0xff6b7b78,
	0xff71708a,
	0xff77778b,
	0xff6e7483,
	0xff585a89,
	0xff5a5c77,
	0xff729642,
	0xff7c9350,
	0xff668950,
	0xff459b41,
	0xff52833e,
	0xff5f8442,
	0xff489532,
	0xff587c3e,
	0xff898a62,
	0xff6f7e8f,
	0xff795577,
	0xff996b60,
	0xff6665a3,
	0xff686898,
	0xff6a778d,
	0xff58618b,
	0xff3c438d,
	0xff4c567b,
	0xff6d6a67,
	0xff7e7f68,
	0xff477b34,
	0xff59677d,
	0xff637c61,
	0xff597f2b,
	0xff8c9647,
	0xff889153,
	0xff5ea82d,
	0xff1e9310,
	0xff336371,
	0xff377066,
	0xff395f2e,
	0xff339840,
	0xff37686d,
	0xff3e541f,
	0xff505714,
	0xff529848,
	0xff918f49,
	0xffb38249,
	0xff817868,
	0xff8a7749,
	0xffa67c3f,
	0xff7f6550,
	0xff998048,
	0xff7c673d,
	0xff606765,
	0xffa0a589,
	0xff9b9490,
	0xff878486,
	0xff979b8e,
	0xff98a595,
	0xff737d6c,
	0xff8b947d,
	0xff73736b,
	0xff577145,
	0xff599118,
	0xff476d5c,
	0xff1d7e51,
	0xff4f945b,
	0xff698a8a,
	0xff529e50,
	0xff22af34,
	0xff3b8261,
	0xff4e9a43,
	0xff37a936,
	0xff366884,
	0xff2a6d62,
	0xff4b8169,
	0xff3d8078,
	0xff2d6f6a,
	0xff2c7458,
	0xff325f70,
	0xff10b426,
	0xff30d127,
	0xff6d9571,
	0xff42af46,
	0xff47a249,
	0xff21ae25,
	0xff4d9b4e,
	0xff3fb43d,
	0xff51b54d,
	0xff2aa027,
	0xff83bc7d,
	0xff979a95,
	0xff7d7a78,
	0xff6f9674,
	0xff7d9793,
	0xffa9afa8,
	0xff96bc94,
	0xffa3b4a4,
	0xff78a474,
	0xff3c8f3d,
	0xff427f3e,
	0xff3c7631,
	0xff6f9b69,
	0xff827880,
	0xff467445,
	0xff528f52,
	0xff377735,
	0xff007900,
	0xff2ea62e,
	0xff3a673a,
	0xff335f33,
	0xff4b824b,
	0xff595d59,
	0xff627163,
	0xff3d973b,
	0xff2c7d29,
	0xff137518,
	0xff93705c,
	0xffc37271,
	0xffb57368,
	0xffbb7769,
	0xffa96e6c,
	0xffba7667,
	0xffb47367,
	0xffbf6e6a,
	0xff997165,
	0xff42b257,
	0xff448550,
	0xff489c52,
	0xff649964,
	0xff697862,
	0xff55a05b,
	0xff449e50,
	0xff4c9765,
	0xff48a15a,
	0xff86675c,
	0xffc68a8d,
	0xffaa8e90,
	0xff997168,
	0xff796357,
	0xff89635e,
	0xffaa7371,
	0xff9b7158,
	0xffac7b73,
	0xff72796d,
	0xff667d62,
	0xff6c7869,
	0xff567258,
	0xff6d6786,
	0xff766287,
	0xff8a302f,
	0xff812040,
	0xff514893,
	0xff428b8b,
	0xff6a838d,
	0xff537179,
	0xff4d72a4,
	0xff70748f,
	0xff657784,
	0xff4063a3,
	0xff2a38a3,
	0xff435784,
	0xff72458b,
	0xff8d4c6a,
	0xff935963,
	0xff7d347b,
	0xff853b64,
	0xff954d73,
	0xff51339b,
	0xff221dae,
	0xff42459f,
	0xff75915a,
	0xff6a8e64,
	0xff479756,
	0xff5b786d,
	0xff758e7a,
	0xff5daa54,
	0xff16c32e,
	0xff4e6e36,
	0xff3a9d32,
	0xffa4896d,
	0xff82647b,
	0xff675871,
	0xff8f7b71,
	0xff796f80,
	0xff897a7d,
	0xff938584,
	0xff837267,
	0xffb4797a,
	0xff8f8673,
	0xff4a7b46,
	0xff5a595a,
	0xff5e935d,
	0xff188117,
	0xff486d3d,
	0xff679054,
	0xff80834d,
	0xff917c66,
	0xff8d82ab,
	0xff4d5182,
	0xff3b3b57,
	0xff8686b1,
	0xff48497b,
	0xff27257a,
	0xff5756ba,
	0xff312e90,
	0xff5d4c76,
	0xff49a641,
	0xff2c882b,
	0xff3a6044,
	0xff45c950,
	0xff228421,
	0xff1f6f1b,
	0xff43a84d,
	0xff4f9659,
	0xff99a29a,
	0xff6c4f80,
	0xff5b4e68,
	0xff695f60,
	0xff575152,
	0xff564c4d,
	0xff6c5769,
	0xff7e6160,
	0xff9e646d,
	0xff947a83,
	0xff50a262,
	0xff2b7236,
	0xff386643,
	0xff2e5c67,
	0xff545e57,
	0xff556550,
	0xff1ca83d,
	0xff458653,
	0xff39636d,
	0xff5c75a0,
	0xff474686,
	0xff434382,
	0xff5758a4,
	0xff3a3a77,
	0xff343493,
	0xff4a4cc3,
	0xff37399f,
	0xff414d7f,
	0xff69ad65,
	0xffa5b8a1,
	0xff6b6977,
	0xff8e9a96,
	0xffa5a6a5,
	0xff6c6e6f,
	0xff71857d,
	0xff5b7168,
	0xff5a7065,
	0xff7d7c73,
	0xff908a89,
	0xff9c9ea9,
	0xff7a7a88,
	0xff7e7f7d,
	0xff817d7b,
	0xff615f6a,
	0xff545761,
	0xff8d6b7d,
	0xff96987c,
	0xff6a6b87,
	0xff574e76,
	0xff34414b,
	0xff473f4c,
	0xff504948,
	0xff9f6d68,
	0xffa57774,
	0xffa17a78,
	0xff7e9961,
	0xff90979b,
	0xff7b7c7f,
	0xff779352,
	0xff828972,
	0xff72794e,
	0xffa0806a,
	0xffa28da7,
	0xffa4997c,
	0xff4d935b,
	0xff496f56,
	0xff41754b,
	0xff5b716d,
	0xff627067,
	0xff80b074,
	0xff597e68,
	0xff3f4f4b,
	0xff1f8836,
	0xff37894c,
	0xff6e7974,
	0xff4c6361,
	0xff6e9775,
	0xff7f7e7d,
	0xff47614b,
	0xff587464,
	0xff47595b,
	0xff2c723c,
	0xff92978c,
	0xff85767a,
	0xff686065,
	0xffc6d0d3,
	0xff919190,
	0xff706a69,
	0xff778982,
	0xff2f4843,
	0xff476146,
	0xffaf8049,
	0xffcc8157,
	0xffc17f56,
	0xffc5815a,
	0xffc38355,
	0xffc47e5c,
	0xffbf7f55,
	0xffbf7c56,
	0xffbd864a,
	0xffb78553,
	0xffb18367,
	0xffb48963,
	0xffac8568,
	0xffb38a75,
	0xffb38266,
	0xffc98a5e,
	0xffb18866,
	0xffbd9155,
	0xffb3904a,
	0xffad8255,
	0xff8c6d46,
	0xff736c48,
	0xff655d4c,
	0xff312f27,
	0xffa2896f,
	0xff8f7061,
	0xff62572a,
	0xffbba674,
	0xffa1937e,
	0xff8d8469,
	0xff7a685a,
	0xff7a736f,
	0xff78776b,
	0xff898468,
	0xff8c7664,
	0xffa18153,
	0xffa69c7e,
	0xff6d717a,
	0xff79746a,
	0xff7c7c71,
	0xff5e5e60,
	0xff867d6d,
	0xff999176,
	0xff767667,
	0xff99865e,
	0xffd29356,
	0xffb38568,
	0xff93886f,
	0xffc08561,
	0xffb28572,
	0xffb3886f,
	0xffce956b,
	0xffb79b7a,
	0xffbd9a5d,
	0xffc8985e,
	0xff7d634a,
	0xff896d4b,
	0xffa88c78,
	0xff3b3a39,
	0xff66543e,
	0xffb9885f,
	0xff9c7f5b,
	0xffbf9755,
	0xffaaa077,
	0xff827c6f,
	0xff8d856e,
	0xff797265,
	0xff69635e,
	0xff7a796b,
	0xff978876,
	0xff948377,
	0xff90844b,
	0xffaf9762,
	0xff846e5b,
	0xff947d5d,
	0xff8a8377,
	0xff70625f,
	0xff8e8070,
	0xff857e63,
	0xff77704a,
	0xffa08054,
	0xff957e91,
	0xff87838e,
	0xff877e81,
	0xff95737b,
	0xff83798b,
	0xff858795,
	0xff7e7992,
	0xff697e79,
	0xff81767e,
	0xff706265,
	0xff5a605d,
	0xff937a6d,
	0xff906d7b,
	0xff766d85,
	0xff846379,
	0xff996f88,
	0xffb6835f,
	0xffae7a51,
	0xffa37154,
	0xff96735c,
	0xff7e6a54,
	0xff926e4d,
	0xff6d6255,
	0xff7b6159,
	0xff805d54,
	0xff76625e,
	0xff5e5451,
	0xff82664e,
	0xffab8e74,
	0xffb49e97,
	0xff9c918e,
	0xff9c9c9e,
	0xff80625a,
	0xffac7b59,
	0xffa69692,
	0xff6e6d95,
	0xff5d6183,
	0xff696970,
	0xff846357,
	0xffa67758,
	0xff706b53,
	0xff716664,
	0xff9996a5,
	0xff949394,
	0xff6f5c56,
	0xff99725b,
	0xff9d8159,
	0xff907f68,
	0xff8d867a,
	0xff9f8063,
	0xff9d6f52,
	0xffc78851,
	0xffb9a68b,
	0xff828488,
	0xffad7a58,
	0xffcd8c5e,
	0xffa9a092,
	0xff777a82,
	0xff9a6f5d,
	0xffca8960,
	0xffada291,
	0xff706e73,
	0xff916b54,
	0xffb0856c,
	0xff988f6c,
	0xff78724c,
	0xff837c6b,
	0xff8a925f,
	0xff5e6908,
	0xff474c15,
	0xff6e543d,
	0xffad4b2a,
	0xffa7a549,
	0xff7f5d43,
	0xff952b13,
	0xff8a2e20,
	0xff5f430b,
	0xff25764f,
	0xff5c8167,
	0xff657e4f,
	0xff485190,
	0xff3f38a1,
	0xff234379,
	0xff1d903c,
	0xff456b4b,
	0xff3b8244,
	0xff818a66,
	0xff887d69,
	0xff4a473b,
	0xff6a5a43,
	0xff877e75,
	0xff786d78,
	0xff108410,
	0xff46692f,
	0xff8f6b7b,
	0xff6c9568,
	0xff137d11,
	0xff4e3a3e,
	0xff8a856f,
	0xff797458,
	0xff474a3f,
	0xff7a7847,
	0xff878d5a,
	0xff877f6a,
	0xff534d44,
	0xff6f6042,
	0xff8c8269,
	0xff7b6f79,
	0xff118314,
	0xff4d7236,
	0xff957370,
	0xff729666,
	0xff148017,
	0xff554245,
	0xff888467,
	0xff7c7959,
	0xff50544b,
	0xff7c7543,
	0xff8d7f50,
	0xff6f675e,
	0xff746f60,
	0xff5c5a47,
	0xff827d6d,
	0xff939292,
	0xff7a797a,
	0xff655b45,
	0xffa08867,
	0xff807671,
	0xff5a5e4c,
	0xff8d7652,
	0xffa5825a,
	0xff756647,
	0xff8c8565,
	0xffb9a077,
	0xff9e5a36,
	0xff5047c5,
	0xff5b62be,
	0xff4c5089,
	0xff736bc4,
	0xffb17f52,
	0xff9e6e4b,
	0xff9e7052,
	0xff9e6f52,
	0xff9e6f51,
	0xff9a6d4f,
	0xffaa6b56,
	0xff8c704e,
	0xff25aa34,
	0xff28b931,
	0xff20b72f,
	0xff42b23d,
	0xffa46f5c,
	0xffa1625b,
	0xff9b6958,
	0xff9b6858,
	0xff9b6857,
	0xff976555,
	0xff996458,
	0xff986a55,
	0xffa58d58,
	0xffb0965d,
	0xffac915b,
	0xffab905b,
	0xffab905b,
	0xffab925d,
	0xffab955c,
	0xffa88b5f,
	0xffc47964,
	0xffcf7a62,
	0xffd07857,
	0xffd96a41,
	0xffd35f43,
	0xffbd654c,
	0xffa06047,
	0xff90604d,
	0xffa19e9e,
	0xff9a9e9f,
	0xff999999,
	0xff9d9d9d,
	0xff8b8b8b,
	0xff848484,
	0xff868686,
	0xff959595,
	0xff959494,
	0xff7e7e7e,
	0xff808080,
	0xff878787,
	0xff8b8b8b,
	0xff8a8a8a,
	0xff82848a,
	0xff8b8881,
	0xff9f8d63,
	0xff9f8d65,
	0xffa29067,
	0xff958566,
	0xff7c7362,
	0xff807762,
	0xff817760,
	0xff827a64,
	0xff79726e,
	0xff756c6d,
	0xff766e6e,
	0xff776c69,
	0xff8c775f,
	0xff907c61,
	0xff8b775f,
	0xff988261,
	0xff928266,
	0xff867966,
	0xff867967,
	0xff847663,
	0xff998864,
	0xffa19067,
	0xff9e8e67,
	0xff998a66,
	0xff9c8258,
	0xffa18356,
	0xff9f8256,
	0xff997e5b,
	0xff947f68,
	0xff978267,
	0xff948267,
	0xff9a8467,
	0xff9b765d,
	0xff98715c,
	0xff98725e,
	0xffa0795e,
	0xffbc8655,
	0xffbf8654,
	0xffbd8853,
	0xffb38158,
	0xff8b6d5f,
	0xff92725f,
	0xff917260,
	0xff8f705d,
	0xffb87e59,
	0xffc3845a,
	0xffc3845d,
	0xffb2725a,
	0xff207916,
	0xff028e06,
	0xff0a8e0d,
	0xff0a8f0d,
	0xff11890d,
	0xff1c860d,
	0xff198010,
	0xff0eae05,
	0xff14a505,
	0xff187710,
	0xff1b810d,
	0xff18840d,
	0xff0d860d,
	0xff0c850d,
	0xff098f04,
	0xff106911,
	0xff63537c,
	0xff7977dd,
	0xff5353b9,
	0xff59599f,
	0xff777482,
	0xff787465,
	0xff6c6862,
	0xff7e7a74,
	0xfff8f8f7,
	0xffffffff,
	0xffffffff,
	0xffffffff,
};
